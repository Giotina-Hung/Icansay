<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>è€å¸«é¡Œåº«è¨­å®š</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-2xl mx-auto bg-white rounded-xl p-6 shadow-md">
    <h1 class="text-2xl font-bold mb-4 text-blue-700">ğŸ“˜ è€å¸«é¡Œåº«è¨­å®š</h1>

    <form id="questionForm" class="space-y-4">
      <div>
        <label class="font-semibold">é¡Œåº« IDï¼ˆé€±æ¬¡ï¼‰</label>
        <input type="text" id="questionId" class="w-full border p-2 rounded" required>
      </div>

      <!-- äº”é¡Œè¼¸å…¥å€ -->
      <div class="grid grid-cols-2 gap-4">
        <div><label>é¡Œç›® 1ï¼ˆä¸­æ–‡ï¼‰</label><input id="q1_zh" class="w-full border p-2 rounded" required></div>
        <div><label>é¡Œç›® 1ï¼ˆè‹±æ–‡ï¼‰</label><input id="q1_en" class="w-full border p-2 rounded" required></div>

        <div><label>é¡Œç›® 2ï¼ˆä¸­æ–‡ï¼‰</label><input id="q2_zh" class="w-full border p-2 rounded" required></div>
        <div><label>é¡Œç›® 2ï¼ˆè‹±æ–‡ï¼‰</label><input id="q2_en" class="w-full border p-2 rounded" required></div>

        <div><label>é¡Œç›® 3ï¼ˆä¸­æ–‡ï¼‰</label><input id="q3_zh" class="w-full border p-2 rounded" required></div>
        <div><label>é¡Œç›® 3ï¼ˆè‹±æ–‡ï¼‰</label><input id="q3_en" class="w-full border p-2 rounded" required></div>

        <div><label>é¡Œç›® 4ï¼ˆä¸­æ–‡ï¼‰</label><input id="q4_zh" class="w-full border p-2 rounded" required></div>
        <div><label>é¡Œç›® 4ï¼ˆè‹±æ–‡ï¼‰</label><input id="q4_en" class="w-full border p-2 rounded" required></div>

        <div><label>é¡Œç›® 5ï¼ˆä¸­æ–‡ï¼‰</label><input id="q5_zh" class="w-full border p-2 rounded" required></div>
        <div><label>é¡Œç›® 5ï¼ˆè‹±æ–‡ï¼‰</label><input id="q5_en" class="w-full border p-2 rounded" required></div>
      </div>

      <div>
        <label class="font-semibold">å¯†ç¢¼é©—è­‰</label>
        <input type="password" id="adminPassword" class="w-full border p-2 rounded" required>
      </div>

      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">â• æ–°å¢é¡Œåº«</button>
    </form>

    <div id="msg" class="mt-4 text-green-600 font-bold"></div>

    <hr class="my-6 border-t">

    <!-- æœªé€šéå­¸ç”Ÿæ¸…å–® -->
    <h2 class="text-lg font-bold mb-2">ğŸš« æ¯é€±æœªé€šéå­¸ç”Ÿ</h2>
    <div id="unpassedList" class="space-y-4 text-red-700 bg-gray-50 p-4 rounded"></div>
  </div>

  <script>
    const apiUrl = "https://script.google.com/macros/s/AKfycbz42AHuGl7eIsyye0CjtjXXwjvP9WCzBrk637DC5Xg7F4hBSBZvYbG2xr_Fwf8SZCG1/exec";

    const form = document.getElementById("questionForm");
    const msg = document.getElementById("msg");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const pwd = document.getElementById("adminPassword").value;
      if (pwd !== "g4k27") {
        msg.textContent = "âŒ å¯†ç¢¼éŒ¯èª¤ï¼Œç„¡æ³•æ–°å¢é¡Œåº«";
        msg.classList.replace("text-green-600", "text-red-600");
        return;
      }

      const body = {
        action: "addQuestions",
        id: document.getElementById("questionId").value.trim(),
        q1_zh: document.getElementById("q1_zh").value.trim(),
        q1_en: document.getElementById("q1_en").value.trim(),
        q2_zh: document.getElementById("q2_zh").value.trim(),
        q2_en: document.getElementById("q2_en").value.trim(),
        q3_zh: document.getElementById("q3_zh").value.trim(),
        q3_en: document.getElementById("q3_en").value.trim(),
        q4_zh: document.getElementById("q4_zh").value.trim(),
        q4_en: document.getElementById("q4_en").value.trim(),
        q5_zh: document.getElementById("q5_zh").value.trim(),
        q5_en: document.getElementById("q5_en").value.trim(),
      };

      const res = await fetch(apiUrl, {
        method: "POST",
        body: JSON.stringify(body)
      });

      if (res.ok) {
        msg.textContent = "âœ… é¡Œåº«å·²æ–°å¢ï¼";
        msg.classList.replace("text-red-600", "text-green-600");
        form.reset();
        loadUnpassed();
      } else {
        msg.textContent = "âŒ ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦";
        msg.classList.replace("text-green-600", "text-red-600");
      }
    });

    async function loadUnpassed() {
      const res = await fetch(apiUrl + "?action=getUnpassedStudents");
      const data = await res.json(); // [{id: "week1", unpassed: ["1", "3"]}]

      const container = document.getElementById("unpassedList");
      container.innerHTML = "";

      if (data.length === 0) {
        container.innerHTML = "<p>ğŸ‰ æ‰€æœ‰å­¸ç”Ÿéƒ½å·²å®ŒæˆæŒ‘æˆ°ï¼</p>";
        return;
      }

      data.forEach(entry => {
        const div = document.createElement("div");
        div.innerHTML = `<strong>ğŸ“˜ é¡Œåº«é€±æ¬¡ï¼š${entry.id}</strong><br/>æœªé€šéå­¸ç”Ÿï¼š${entry.unpassed.join(", ")}`;
        container.appendChild(div);
      });
    }

    loadUnpassed();
  </script>
</body>
</html>
